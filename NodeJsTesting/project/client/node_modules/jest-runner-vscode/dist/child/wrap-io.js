"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = __importDefault(require("util"));
const console_1 = __importDefault(require("console"));
function wrapIO(client, globalObject = global) {
    const consolePrintMethods = [
        'log',
        'info',
        'warn',
        'error',
    ];
    const actualProperties = Object.getOwnPropertyDescriptors(console_1.default);
    consolePrintMethods.forEach(method => {
        Object.defineProperty(globalObject.console, method, {
            value: (...args) => {
                const event = method === 'error' || method === 'warn' ? 'stderr' : 'stdout';
                const formatted = util_1.default.format(...args);
                client.emit(event, formatted);
            },
        });
    });
    Object.defineProperty(globalObject.console, 'dir', {
        value: (...args) => {
            const formatted = util_1.default.inspect(...args);
            client.emit('stdout', formatted);
        },
    });
    const onDisconnect = () => {
        ;
        [...consolePrintMethods, 'dir'].forEach(method => {
            Object.defineProperty(globalObject.console, method, actualProperties[method]);
        });
    };
    client.once('disconnect', onDisconnect);
}
exports.default = wrapIO;
